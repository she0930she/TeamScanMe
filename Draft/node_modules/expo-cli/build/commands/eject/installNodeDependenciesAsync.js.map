{"version":3,"sources":["../../../src/commands/eject/installNodeDependenciesAsync.ts"],"names":["installNodeDependenciesAsync","projectRoot","packageManager","clean","cleanJsDepsStep","CreateApp","logNewSection","fs","remove","succeed","installJsDepsStep","message","chalk","bold","fail","red","SilentError"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA;;;;;AAKO,eAAeA,4BAAf,CACLC,WADK,EAELC,cAFK,EAGL;AAAEC,EAAAA,KAAK,GAAG;AAAV,CAHK,EAIL;AACA,MAAIA,KAAJ,EAAW;AACT;AACA;AACA,UAAMC,eAAe,GAAGC,SAAS,GAACC,aAAV,CAAwB,mCAAxB,CAAxB,CAHS,CAIT;AACA;;AACA,UAAMC,mBAAGC,MAAH,CAAU,cAAV,CAAN;AACAJ,IAAAA,eAAe,CAACK,OAAhB,CAAwB,kCAAxB;AACD;;AAED,QAAMC,iBAAiB,GAAGL,SAAS,GAACC,aAAV,CAAwB,qCAAxB,CAA1B;;AAEA,MAAI;AACF,UAAMD,SAAS,GAACL,4BAAV,CAAuCC,WAAvC,EAAoDC,cAApD,CAAN;AACAQ,IAAAA,iBAAiB,CAACD,OAAlB,CAA0B,oCAA1B;AACD,GAHD,CAGE,gBAAM;AACN,UAAME,OAAO,GAAI,uEAAsET,cAAe,mBAAkBU,iBAAMC,IAAN,CACrH,GAAEX,cAAe,UADoG,CAEtH,kBAFF;AAGAQ,IAAAA,iBAAiB,CAACI,IAAlB,CAAuBF,iBAAMG,GAAN,CAAUJ,OAAV,CAAvB,EAJM,CAKN;;AACA,UAAM,KAAIK,2BAAJ,EAAgBL,OAAhB,CAAN;AACD;AACF","sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs-extra';\n\nimport { SilentError } from '../../CommandError';\nimport * as CreateApp from '../utils/CreateApp';\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nexport async function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean) {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = CreateApp.logNewSection('Cleaning JavaScript dependencies.');\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed('Cleaned JavaScript dependencies.');\n  }\n\n  const installJsDepsStep = CreateApp.logNewSection('Installing JavaScript dependencies.');\n\n  try {\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed('Installed JavaScript dependencies.');\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n"],"file":"installNodeDependenciesAsync.js"}