{"version":3,"sources":["detach/Detach.js"],"names":["SERVICE_CONTEXT_PROJECT_NAME","async","yesnoAsync","message","ok","await","prompts","type","name","initial","detachAsync","projectRoot","options","originalLogger","logger","loggerObj","configure","trace","verbose","console","bind","debug","info","warn","error","fatal","_detachAsync","user","UserManager","ensureLoggedInAsync","Error","username","configName","configPath","configNamespace","findConfigFile","let","exp","getConfig","experienceName","slug","experienceUrl","hasIosDirectory","isDirectory","path","join","hasAndroidDirectory","XDLError","process","platform","response","sdkVersion","Versions","gteSdkVersion","versions","versionsAsync","sdkVersionConfig","sdkVersions","androidExpoViewUrl","iosExpoViewUrl","env","EXPO_VIEW_DIR","isDetached","detach","detachedUUID","uuid","v4","replace","generatedScheme","scheme","linkingWarning","Array","isArray","length","push","expoDirectory","fs","mkdirpSync","context","StandaloneContext","createUserContext","isIosSupported","force","ios","bundleIdentifier","iosBundleIdentifier","validate","value","test","detachIOSAsync","IosWorkspace","addDetachedConfigToExp","android","package","androidPackage","androidDirectory","rimraf","sync","detachAndroidAsync","AndroidShellApp","config","writeFile","JSON","stringify","packagesToInstall","expoReactNativeTag","spawnAsync","cwd","expokitNpmPackage","packagesToInstallWhenEjecting","isPlainObject","Object","keys","forEach","packageName","installPackagesAsync","packageManager","createDetachedAsync","IosNSBundle","configureAsync","expoViewUrl","androidProjectDirectory","data","projectPath","tmpExpoDirectory","copyInitialShellAppFilesAsync","Api","downloadAsync","extract","runShellAppModificationsAsync","rimrafDontThrow","ensureBuildConstantsExistsIOSAsync","configFilePath","doesBuildConstantsExist","existsSync","IosPlist","createBlankAsync","_getIosExpoKitVersionThrowErrorAsync","iosProjectDirectory","expoKitVersion","podfileLockPath","podfileLock","readFile","expoKitVersionRegex","match","exec","e","readNullableConfigJsonAsync","projectDir","_","prepareDetachedBuildIosAsync","args","prepareDetachedUserContextIosAsync","prepareDetachedServiceContextIosAsync","expoRootDir","workspaceSourcePath","buildFlags","StandaloneBuildFlags","createIos","createServiceContext","supportingDirectory","getPaths","prodApiKeys","_readDefaultApiKeysAsync","expoSourcePath","skipSDKVersionRequirement","modifyAsync","constantsConfig","contextType","STANDALONE_CONTEXT_TYPE","EXPO_RUNTIME_VERSION","API_SERVER_ENDPOINT","ENVIRONMENT","DEFAULT_API_KEYS","TEMPORARY_SDK_VERSION","jsonFilePath","allKeys","JsonFile","readAsync","validKeys","key","hasOwnProperty","includes","podsDirectory","rnPodDirectory","rnFilesToDelete","globSync","absolute","i","unlink","skipXcodeConfig","devUrl","UrlUtils","constructManifestUrlAsync","defaultApiKeys","developmentUrl","prepareDetachedBuildAsync","expoBuildConstantsMatches","expoBuildConstants","regexFileAsync","bundleAssetsAsync","bundledManifestPath","EmbeddedAssets","getEmbeddedManifestPath","manifest","parse","ex","AssetBundle","bundleAsync","bundledAssets","dest","getExportUrl","bundleUrl","DEFAULT_CDN_HOST","bundleUrlParts","split","slice"],"mappings":"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","file":"../../detach/Detach.js","sourcesContent":["// Set EXPO_VIEW_DIR to universe/exponent to test locally\n\nimport { findConfigFile, getConfig } from '@expo/config';\nimport JsonFile from '@expo/json-file';\nimport spawnAsync from '@expo/spawn-async';\nimport fs from 'fs-extra';\nimport { sync as globSync } from 'glob';\nimport isPlainObject from 'lodash/isPlainObject';\nimport path from 'path';\nimport process from 'process';\nimport prompts from 'prompts';\nimport rimraf from 'rimraf';\nimport uuid from 'uuid';\n\nimport Api from '../Api';\nimport * as EmbeddedAssets from '../EmbeddedAssets';\nimport * as UrlUtils from '../UrlUtils';\nimport UserManager from '../User';\nimport * as Versions from '../Versions';\nimport XDLError from '../XDLError';\nimport * as AndroidShellApp from './AndroidShellApp';\nimport * as AssetBundle from './AssetBundle';\nimport { isDirectory, regexFileAsync, rimrafDontThrow } from './ExponentTools';\nimport * as IosNSBundle from './IosNSBundle';\nimport * as IosPlist from './IosPlist';\nimport * as IosWorkspace from './IosWorkspace';\nimport logger from './Logger';\nimport StandaloneBuildFlags from './StandaloneBuildFlags';\nimport StandaloneContext from './StandaloneContext';\nimport installPackagesAsync from './installPackagesAsync';\n\nconst SERVICE_CONTEXT_PROJECT_NAME = 'exponent-view-template';\n\nasync function yesnoAsync(message) {\n  const { ok } = await prompts({\n    type: 'confirm',\n    name: 'ok',\n    initial: true,\n    message,\n  });\n  return ok;\n}\n\nexport async function detachAsync(projectRoot, options = {}) {\n  const originalLogger = logger.loggerObj;\n  logger.configure({\n    trace: options.verbose ? console.trace.bind(console) : () => {},\n    debug: options.verbose ? console.debug.bind(console) : () => {},\n    info: options.verbose ? console.info.bind(console) : () => {},\n    warn: console.warn.bind(console),\n    error: console.error.bind(console),\n    fatal: console.error.bind(console),\n  });\n  try {\n    return await _detachAsync(projectRoot, options);\n  } finally {\n    logger.configure(originalLogger);\n  }\n}\n\nasync function _detachAsync(projectRoot, options) {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  if (!user) {\n    throw new Error('Internal error -- somehow detach is being run in offline mode.');\n  }\n\n  const username = user.username;\n  const { configName, configPath, configNamespace } = findConfigFile(projectRoot);\n  let { exp } = getConfig(projectRoot);\n  const experienceName = `@${username}/${exp.slug}`;\n  const experienceUrl = `exp://exp.host/${experienceName}`;\n\n  // Check to make sure project isn't fully detached already\n  const hasIosDirectory = isDirectory(path.join(projectRoot, 'ios'));\n  const hasAndroidDirectory = isDirectory(path.join(projectRoot, 'android'));\n\n  if (hasIosDirectory && hasAndroidDirectory) {\n    throw new XDLError(\n      'DIRECTORY_ALREADY_EXISTS',\n      'Error detaching. `ios` and `android` directories already exist.'\n    );\n  }\n\n  // Project was already detached on Windows or Linux\n  if (!hasIosDirectory && hasAndroidDirectory && process.platform === 'darwin') {\n    const response = await yesnoAsync(\n      `This will add an Xcode project and leave your existing Android project alone. Enter 'yes' to continue:`\n    );\n    if (!response) {\n      logger.info('Exiting...');\n      return false;\n    }\n  }\n\n  if (hasIosDirectory && !hasAndroidDirectory) {\n    throw new Error('`ios` directory already exists. Please remove it and try again.');\n  }\n\n  logger.info('Validating project manifest...');\n  if (!exp.name) {\n    throw new Error(`${configName} is missing \\`name\\``);\n  }\n\n  if (!exp.sdkVersion) {\n    throw new Error(`${configName} is missing \\`sdkVersion\\``);\n  }\n\n  if (!Versions.gteSdkVersion(exp, '25.0.0')) {\n    throw new Error(\n      `The app must be updated to SDK 25.0.0 or newer to be compatible with this tool.`\n    );\n  }\n\n  const versions = await Versions.versionsAsync();\n  let sdkVersionConfig = versions.sdkVersions[exp.sdkVersion];\n  if (\n    !sdkVersionConfig ||\n    (!sdkVersionConfig.androidExpoViewUrl && !sdkVersionConfig.iosExpoViewUrl)\n  ) {\n    if (process.env.EXPO_VIEW_DIR) {\n      logger.warn(\n        `Detaching is not supported for SDK ${exp.sdkVersion}; ignoring this because you provided EXPO_VIEW_DIR`\n      );\n      sdkVersionConfig = {};\n    } else {\n      throw new Error(`Detaching is not supported for SDK version ${exp.sdkVersion}`);\n    }\n  }\n\n  exp.isDetached = true;\n\n  if (!exp.detach) {\n    exp.detach = {};\n  }\n\n  const detachedUUID = uuid.v4().replace(/-/g, '');\n  const generatedScheme = `exp${detachedUUID}`;\n\n  if (!exp.detach.scheme && !Versions.gteSdkVersion(exp, '27.0.0')) {\n    // set this for legacy purposes\n    exp.detach.scheme = generatedScheme;\n  }\n\n  const linkingWarning = `You have not specified a custom scheme for deep linking. A default value of ${generatedScheme} will be used. You can change this later by following the instructions in this guide: https://docs.expo.io/workflow/linking/`;\n  if (!exp.scheme) {\n    logger.info(linkingWarning);\n    exp.scheme = generatedScheme;\n  } else if (Array.isArray(exp.scheme) && exp.scheme.length === 0) {\n    logger.info(linkingWarning);\n    exp.scheme.push(generatedScheme);\n  }\n\n  const expoDirectory = path.join(projectRoot, '.expo-source');\n  fs.mkdirpSync(expoDirectory);\n  const context = StandaloneContext.createUserContext(projectRoot, exp, experienceUrl);\n\n  // iOS\n  let isIosSupported = true;\n  if (process.platform !== 'darwin') {\n    if (options && options.force) {\n      logger.warn(\n        `You are not running macOS, but have provided the --force option, so we will attempt to generate an iOS project anyway. This might fail.`\n      );\n    } else {\n      logger.warn(`Skipping iOS because you are not running macOS.`);\n      isIosSupported = false;\n    }\n  }\n\n  if (!hasIosDirectory && isIosSupported && sdkVersionConfig.iosExpoViewUrl) {\n    if (!exp.ios) {\n      exp.ios = {};\n    }\n    if (!exp.ios.bundleIdentifier) {\n      logger.info(\n        `You'll need to specify an iOS bundle identifier. See: https://docs.expo.io/versions/latest/config/app/#ios`\n      );\n      const { iosBundleIdentifier } = await prompts({\n        type: 'text',\n        name: 'iosBundleIdentifier',\n        message: 'What would you like your iOS bundle identifier to be?',\n        validate: value => /^[a-zA-Z][a-zA-Z0-9\\-.]+$/.test(value),\n      });\n      exp.ios.bundleIdentifier = iosBundleIdentifier;\n    }\n\n    await detachIOSAsync(context);\n    exp = IosWorkspace.addDetachedConfigToExp(exp, context);\n    exp.detach.iosExpoViewUrl = sdkVersionConfig.iosExpoViewUrl;\n  }\n\n  // Android\n  if (!hasAndroidDirectory && sdkVersionConfig.androidExpoViewUrl) {\n    if (!exp.android) {\n      exp.android = {};\n    }\n    if (!exp.android.package) {\n      logger.info(\n        `You'll need to specify an Android package name. See: https://docs.expo.io/versions/latest/config/app/#android`\n      );\n      const { androidPackage } = await prompts({\n        type: 'text',\n        name: 'androidPackage',\n        message: 'What would you like your Android package name to be?',\n        validate: value =>\n          /^[a-zA-Z][a-zA-Z0-9_]*(\\.[a-zA-Z][a-zA-Z0-9_]*)+$/.test(value)\n            ? true\n            : \"Invalid format of Android package name (only alphanumeric characters, '.' and '_' are allowed, and each '.' must be followed by a letter)\",\n      });\n      exp.android.package = androidPackage;\n    }\n\n    const androidDirectory = path.join(expoDirectory, 'android');\n    rimraf.sync(androidDirectory);\n    fs.mkdirpSync(androidDirectory);\n    await detachAndroidAsync(context, sdkVersionConfig.androidExpoViewUrl);\n    exp = AndroidShellApp.addDetachedConfigToExp(exp, context);\n    exp.detach.androidExpoViewUrl = sdkVersionConfig.androidExpoViewUrl;\n  }\n\n  logger.info('Writing ExpoKit configuration...');\n  // if we're writing to app.json, we need to place the configuration under the expo key\n  const config = configNamespace ? { [configNamespace]: exp } : exp;\n  await fs.writeFile(configPath, JSON.stringify(config, null, 2));\n\n  const packagesToInstall = [];\n\n  if (sdkVersionConfig && sdkVersionConfig.expoReactNativeTag) {\n    packagesToInstall.push(\n      `react-native@https://github.com/expo/react-native/archive/${sdkVersionConfig.expoReactNativeTag}.tar.gz`\n    );\n  } else if (process.env.EXPO_VIEW_DIR) {\n    // ignore, using test directory\n  } else {\n    throw new Error(`Expo's fork of react-native does not support this SDK version.`);\n  }\n\n  // Add expokitNpmPackage if it is supported. Was added before SDK 29.\n  if (process.env.EXPO_VIEW_DIR) {\n    logger.info(`Linking 'expokit' package...`);\n    await spawnAsync('yarn', ['link'], {\n      cwd: path.join(process.env.EXPO_VIEW_DIR, 'expokit-npm-package'),\n    });\n    await spawnAsync('yarn', ['link', 'expokit'], {\n      cwd: projectRoot,\n    });\n  } else if (sdkVersionConfig.expokitNpmPackage) {\n    packagesToInstall.push(sdkVersionConfig.expokitNpmPackage);\n  }\n\n  if (sdkVersionConfig) {\n    const { packagesToInstallWhenEjecting } = sdkVersionConfig;\n    if (isPlainObject(packagesToInstallWhenEjecting)) {\n      Object.keys(packagesToInstallWhenEjecting).forEach(packageName => {\n        packagesToInstall.push(`${packageName}@${packagesToInstallWhenEjecting[packageName]}`);\n      });\n    }\n  }\n\n  if (packagesToInstall.length) {\n    await installPackagesAsync(projectRoot, packagesToInstall, {\n      packageManager: options.packageManager,\n    });\n  }\n  return true;\n}\n\n/**\n *  Create a detached Expo iOS app pointing at the given project.\n */\nasync function detachIOSAsync(context) {\n  await IosWorkspace.createDetachedAsync(context);\n\n  logger.info('Configuring iOS project...');\n  await IosNSBundle.configureAsync(context);\n\n  logger.info(`iOS detach is complete!`);\n}\n\nasync function detachAndroidAsync(context, expoViewUrl) {\n  if (context.type !== 'user') {\n    throw new Error(`detachAndroidAsync only supports user standalone contexts`);\n  }\n\n  logger.info('Moving Android project files...');\n  const androidProjectDirectory = path.join(context.data.projectPath, 'android');\n  let tmpExpoDirectory;\n  if (process.env.EXPO_VIEW_DIR) {\n    // Only for testing\n    await AndroidShellApp.copyInitialShellAppFilesAsync(\n      path.join(process.env.EXPO_VIEW_DIR, 'android'),\n      androidProjectDirectory,\n      true,\n      context.data.exp.sdkVersion\n    );\n  } else {\n    tmpExpoDirectory = path.join(context.data.projectPath, 'temp-android-directory');\n    fs.mkdirpSync(tmpExpoDirectory);\n    logger.info('Downloading Android code...');\n    await Api.downloadAsync(expoViewUrl, tmpExpoDirectory, { extract: true });\n    await AndroidShellApp.copyInitialShellAppFilesAsync(\n      tmpExpoDirectory,\n      androidProjectDirectory,\n      true,\n      context.data.exp.sdkVersion\n    );\n  }\n\n  logger.info('Updating Android app...');\n  await AndroidShellApp.runShellAppModificationsAsync(context, context.data.exp.sdkVersion);\n\n  // Clean up\n  logger.info('Cleaning up Android...');\n  if (!process.env.EXPO_VIEW_DIR) {\n    rimrafDontThrow(tmpExpoDirectory);\n  }\n  logger.info('Android detach is complete!\\n');\n}\n\nasync function ensureBuildConstantsExistsIOSAsync(configFilePath) {\n  // EXBuildConstants is included in newer ExpoKit projects.\n  // create it if it doesn't exist.\n  const doesBuildConstantsExist = fs.existsSync(\n    path.join(configFilePath, 'EXBuildConstants.plist')\n  );\n  if (!doesBuildConstantsExist) {\n    await IosPlist.createBlankAsync(configFilePath, 'EXBuildConstants');\n    logger.info('Created `EXBuildConstants.plist` because it did not exist yet');\n  }\n}\n\nasync function _getIosExpoKitVersionThrowErrorAsync(iosProjectDirectory) {\n  let expoKitVersion = '';\n  const podfileLockPath = path.join(iosProjectDirectory, 'Podfile.lock');\n  try {\n    const podfileLock = await fs.readFile(podfileLockPath, 'utf8');\n    const expoKitVersionRegex = /ExpoKit\\/Core\\W?\\(([0-9.]+)\\)/gi;\n    const match = expoKitVersionRegex.exec(podfileLock);\n    expoKitVersion = match[1];\n  } catch (e) {\n    throw new Error(\n      `Unable to read ExpoKit version from Podfile.lock. Make sure your project depends on ExpoKit. (${e})`\n    );\n  }\n  return expoKitVersion;\n}\n\nasync function readNullableConfigJsonAsync(projectDir) {\n  try {\n    return getConfig(projectDir);\n  } catch (_) {\n    return null;\n  }\n}\n\nasync function prepareDetachedBuildIosAsync(projectDir, args) {\n  const config = await readNullableConfigJsonAsync(projectDir);\n  if (config && config.exp.name !== SERVICE_CONTEXT_PROJECT_NAME) {\n    return prepareDetachedUserContextIosAsync(projectDir, config.exp, args);\n  } else {\n    return prepareDetachedServiceContextIosAsync(projectDir, args);\n  }\n}\n\nasync function prepareDetachedServiceContextIosAsync(projectDir, args) {\n  // service context\n  // TODO: very brittle hack: the paths here are hard coded to match the single workspace\n  // path generated inside IosShellApp. When we support more than one path, this needs to\n  // be smarter.\n  const expoRootDir = path.join(projectDir, '..', '..');\n  const workspaceSourcePath = path.join(projectDir, 'ios');\n  const buildFlags = StandaloneBuildFlags.createIos('Release', { workspaceSourcePath });\n  const context = StandaloneContext.createServiceContext(\n    expoRootDir,\n    null,\n    null,\n    null,\n    /* testEnvironment */ 'none',\n    buildFlags,\n    null,\n    null\n  );\n  const { iosProjectDirectory, supportingDirectory } = IosWorkspace.getPaths(context);\n  const expoKitVersion = await _getIosExpoKitVersionThrowErrorAsync(iosProjectDirectory);\n\n  // use prod api keys if available\n  const prodApiKeys = await _readDefaultApiKeysAsync(\n    path.join(context.data.expoSourcePath, '__internal__', 'keys.json')\n  );\n\n  const { exp } = getConfig(expoRootDir, { skipSDKVersionRequirement: true });\n\n  await IosPlist.modifyAsync(supportingDirectory, 'EXBuildConstants', constantsConfig => {\n    // verify that we are actually in a service context and not a misconfigured project\n    const contextType = constantsConfig.STANDALONE_CONTEXT_TYPE;\n    if (contextType !== 'service') {\n      throw new Error(\n        'Unable to configure a project which has no app.json and also no STANDALONE_CONTEXT_TYPE.'\n      );\n    }\n    constantsConfig.EXPO_RUNTIME_VERSION = expoKitVersion;\n    constantsConfig.API_SERVER_ENDPOINT =\n      process.env.ENVIRONMENT === 'staging'\n        ? 'https://staging.exp.host/--/api/v2/'\n        : 'https://exp.host/--/api/v2/';\n    if (prodApiKeys) {\n      constantsConfig.DEFAULT_API_KEYS = prodApiKeys;\n    }\n    if (exp && exp.sdkVersion) {\n      constantsConfig.TEMPORARY_SDK_VERSION = exp.sdkVersion;\n    }\n    return constantsConfig;\n  });\n}\n\nasync function _readDefaultApiKeysAsync(jsonFilePath) {\n  if (fs.existsSync(jsonFilePath)) {\n    const keys = {};\n    const allKeys = await new JsonFile(jsonFilePath).readAsync();\n    const validKeys = ['AMPLITUDE_KEY', 'GOOGLE_MAPS_IOS_API_KEY'];\n    for (const key in allKeys) {\n      if (allKeys.hasOwnProperty(key) && validKeys.includes(key)) {\n        keys[key] = allKeys[key];\n      }\n    }\n    return keys;\n  }\n  return null;\n}\n\nasync function prepareDetachedUserContextIosAsync(projectDir, exp, args) {\n  const context = StandaloneContext.createUserContext(projectDir, exp);\n  const { iosProjectDirectory, supportingDirectory } = IosWorkspace.getPaths(context);\n\n  logger.info(`Preparing iOS build at ${iosProjectDirectory}...`);\n  // These files cause @providesModule naming collisions\n  // but are not available until after `pod install` has run.\n  const podsDirectory = path.join(iosProjectDirectory, 'Pods');\n  if (!isDirectory(podsDirectory)) {\n    throw new Error(`Can't find directory ${podsDirectory}, make sure you've run pod install.`);\n  }\n  const rnPodDirectory = path.join(podsDirectory, 'React');\n  if (isDirectory(rnPodDirectory)) {\n    const rnFilesToDelete = globSync('**/*.@(js|json)', {\n      absolute: true,\n      cwd: rnPodDirectory,\n    });\n    if (rnFilesToDelete) {\n      for (let i = 0; i < rnFilesToDelete.length; i++) {\n        await fs.unlink(rnFilesToDelete[i]);\n      }\n    }\n  }\n\n  // insert expo development url into iOS config\n  if (!args.skipXcodeConfig) {\n    // populate EXPO_RUNTIME_VERSION from ExpoKit pod version\n    const expoKitVersion = await _getIosExpoKitVersionThrowErrorAsync(iosProjectDirectory);\n\n    // populate development url\n    const devUrl = await UrlUtils.constructManifestUrlAsync(projectDir);\n\n    // populate default api keys\n    const defaultApiKeys = await _readDefaultApiKeysAsync(\n      path.join(podsDirectory, 'ExpoKit', 'template-files', 'keys.json')\n    );\n\n    await ensureBuildConstantsExistsIOSAsync(supportingDirectory);\n    await IosPlist.modifyAsync(supportingDirectory, 'EXBuildConstants', constantsConfig => {\n      constantsConfig.developmentUrl = devUrl;\n      constantsConfig.EXPO_RUNTIME_VERSION = expoKitVersion;\n      if (defaultApiKeys) {\n        constantsConfig.DEFAULT_API_KEYS = defaultApiKeys;\n      }\n      if (exp.sdkVersion) {\n        constantsConfig.TEMPORARY_SDK_VERSION = exp.sdkVersion;\n      }\n      return constantsConfig;\n    });\n  }\n}\n\nexport async function prepareDetachedBuildAsync(projectDir, args) {\n  if (args.platform === 'ios') {\n    await prepareDetachedBuildIosAsync(projectDir, args);\n  } else {\n    const expoBuildConstantsMatches = globSync('android/**/DetachBuildConstants.java', {\n      absolute: true,\n      cwd: projectDir,\n    });\n    if (expoBuildConstantsMatches && expoBuildConstantsMatches.length) {\n      const expoBuildConstants = expoBuildConstantsMatches[0];\n      const devUrl = await UrlUtils.constructManifestUrlAsync(projectDir);\n      await regexFileAsync(\n        /DEVELOPMENT_URL = \"[^\"]*\";/,\n        `DEVELOPMENT_URL = \"${devUrl}\";`,\n        expoBuildConstants\n      );\n    }\n  }\n}\n\n// args.dest: string,\n// This is the path where assets will be copied to. It should be\n// `$CONFIGURATION_BUILD_DIR/$UNLOCALIZED_RESOURCES_FOLDER_PATH` on iOS\n// (see `exponent-view-template.xcodeproj/project.pbxproj` for an example)\n// and `$buildDir/intermediates/assets/$targetPath` on Android (see\n// `android/app/expo.gradle` for an example).\nexport async function bundleAssetsAsync(projectDir, args) {\n  const options = await readNullableConfigJsonAsync(projectDir);\n  if (!options || options.exp.name === SERVICE_CONTEXT_PROJECT_NAME) {\n    // Don't run assets bundling for the service context.\n    return;\n  }\n  const { exp } = options;\n  const bundledManifestPath = EmbeddedAssets.getEmbeddedManifestPath(\n    args.platform,\n    projectDir,\n    exp\n  );\n  if (!bundledManifestPath) {\n    logger.warn(\n      `Skipped assets bundling because the '${args.platform}.publishManifestPath' key is not specified in the app manifest.`\n    );\n    return;\n  }\n\n  let manifest;\n  try {\n    manifest = JSON.parse(await fs.readFile(bundledManifestPath, 'utf8'));\n  } catch (ex) {\n    throw new Error(\n      `Error reading the manifest file. Make sure the path '${bundledManifestPath}' is correct.\\n\\nError: ${ex.message}`\n    );\n  }\n  if (!manifest || !Object.keys(manifest).length) {\n    throw new Error(`The manifest at '${bundledManifestPath}' was empty or invalid.`);\n  }\n\n  await AssetBundle.bundleAsync(null, manifest.bundledAssets, args.dest, getExportUrl(manifest));\n}\n\n/**\n * This function extracts the exported public URL that is set in the manifest\n * when the developer runs `expo export --public-url x`. We use this to ensure\n * that we fetch the resources from the appropriate place when doing builds\n * against self-hosted apps.\n */\nfunction getExportUrl(manifest) {\n  const { bundleUrl } = manifest;\n  if (bundleUrl.includes(AssetBundle.DEFAULT_CDN_HOST)) {\n    return null;\n  }\n\n  try {\n    const bundleUrlParts = bundleUrl.split('/');\n    return bundleUrlParts.slice(0, bundleUrlParts.length - 2).join('/');\n  } catch (e) {\n    throw Error(\n      `Expected bundleUrl to be of the format https://domain/bundles/bundle-hash-id, ${bundleUrl} does not follow this format.`\n    );\n  }\n}\n"],"sourceRoot":"/@expo/xdl@59.0.24/src"}